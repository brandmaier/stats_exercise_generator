---
title: "Arbeitsblatt 2 - Chi Quadrat Tests"
author: "Statistik II - Andreas M. Brandmaier"
date: "11/11/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE)

source("R/mcnemar.R")
source("R/chisq.R")

include_solution <- !TRUE

empty_str <- "\\ "
```


# Aufgabe 1

In einer randomisierten Studie haben 40 Patienten ein neuartiges Antidepressivum erhalten und 40 Patienten ein Placebo. Nach vier Wochen wurde erhoben, ob sich eine Verbesserung der Symptomatik eingestellt hat. Dies wurde als dichotomes Merkmal _Verbesserung_ (ja/nein) erhoben. Ein Forscherteam hat die Hypothese, dass das neuartige Antidepressivum wirksamer als eine Placebo-Behandlung ist.

Folgende Daten wurden beobachtet:

```{r}
set.seed(3249)
csq <- generate_chisq()

chisq_data_table(csq)
```

Berechnen Sie zunächst die Spalten- und Randsummen für diese Häufigkeits-Tabelle. Erstellen Sie dann eine Tabelle von Häufigkeiten, die man erwarten würde, wenn es keinen Zusammenhang gäbe. Berechnen Sie dann die Prüfgröße für den Unabhängigkeits-Test und treffen Sie eine statistische Entscheidung.

```{r}


chisq_data_table(csq, type="sums")

chisq_data_table(csq, type="indep")


```

`r if (isTRUE(include_solution)){ "_Lösung:_"} `

Dies ist die Kontigenztabelle mit Zeilensummen und Spaltensummen:
`r chisq_data_table(csq, TRUE, FALSE)`

Dies ist die Tabelle der erwarteten Häufigkeiten unter der Unabhängigkeitsannahme:
`r chisq_data_table(csq, TRUE, TRUE)`

$`r chisq_solution(csq)`$

`r chisq_crit(csq)`

Der empirische _F_-Wert ist größer als der kritische Wert. Wir lehnen daher die Nullhypothese ab. Es gibt Unterschiede in der Wirksamkeit zwischen Antidepressivum und Placebo.


# Aufgabe 2

In zweites Forscher-Team untersucht dasselbe Antidepressivum wie das Forscher-Team aus der ersten Aufgabe. Allerdings haben sich die Forschenden hier für ein Design entschieden, in dem jede Person zweimal untersucht wird und zwar in einem Zeitraum, in dem sie das Medikament erhält und nach einem Zeitraum in dem sie das Medikament nicht erhalten hat.  Kann der Zufall die Unterschiede in den beobachteten Häufigkeiten produzieren? Formulieren Sie die Null-Hypothese und rechnen Sie den richtigen Test. Treffen Sie eine statistisch informierte Entscheidung. Welche Effektstärke kann man hier berichten?

```{r}
csq <- generate_chisq(labels.a = c("Vorher","Nachher"),labels.b=c("Mit Medikament","Ohne Medikament"),
                       tbl = matrix(c(45,33,35,43),ncol=2,byrow = FALSE))

chisq_data_table(csq)
```

$`r mcnemar_solution(csq)`$


`r chisq_crit(csq)`

$`r mcnemar_effectsize(csq)`$

# Aufgabe 3

Laut einer Statista-Studie (https://de.statista.com/statistik/daten/studie/30157/umfrage/anzahl-der-haustiere-in-deutschen-haushalten-seit-2008/) gehen wir davon aus, dass in der Bevölkerung die Vorliebe für Haustiere folgendermaßen verteilt ist:

Katzen: 15.7%
Hunde: 10.7%
Andere: 13%  
Keine: 60.6%

Wir gehen weiterhin davon aus, dass keine Mehrfachnennungen möglich sind. In einer Studie wurde untersucht, ob sich die Vorlieben bei Psychologiestudierenden von der Normalbevölkerung unterscheiden. Beobachtet wurden folgende absoluten Häufigkeiten in einer Stichprobe von 100 Studierenden:


```{r}
obs <- c(24,11,10,55)
n <- sum(obs)
labels <- c("Katzen","Hunde","Andere","Keine")
expected <- c(15.7,10.7,13,60.6)
csq <- generate_chisq_uni( obs=obs,exp=expected,labels=labels )
chisq_uni_data_table(csq) 
```

_Lösung_:

$`r solution_chisq_uni(csq)`$

# Aufgabe 4

In einer Studie wurde untersucht, ob sich die Fehlzeiten von Studierenden über die Jahrgänge hinweg unterscheiden. Die Stichproben sind unabhängig, d.h. es wurden in einem Kalenderjahr Studierende aus verschiedenen Anfangssemestern befragt. Folgende Daten der Jahrgänge wurden erhoben:

```{r}
csq <- generate_chisq(labels.b = c("SS19","WS19/20","SS20","SS20/21"), labels.a=c("ja","nein"),tbl = matrix(c(88,12,95,5, 93,7,95,5), ncol=4))

chisq_data_table(csq)



```

Testen Sie, ob sich die Fehlzeiten über die Semester hinweg unterscheiden.

Dies ist die Kontingenztabelle unter der Unabhängigkeitsannahme:
`r chisq_data_table(csq, TRUE,TRUE)`

$`r chisq_solution(csq)`$

`r chisq_crit(csq)`

# Aufgabe 5
Wie müsste die Kontingenztabelle der beobachteten Häufigkeiten lauten, wenn man testen möchte, ob sich die Anwesenheit in den Sommer- und Wintersemestern unterscheidet? Führen Sie den entsprechenden Test durch.

```{r} 
tbl <- cbind(rowSums(csq$tbl[,c(1,3)]),rowSums(csq$tbl[,c(2,4)]))
csq <- generate_chisq(labels.b = c("Sommer","Winter"), labels.a=c("ja","nein"),tbl=tbl)

```

`r if (isTRUE(include_solution)){ "_Lösung:_"} `



`r chisq_data_table(csq,  caption="Zusammengefasste Datentabelle")`


`r chisq_data_table(csq, type="indep", caption="Tabelle unter Unabhängigkeitsannahme")`

$`r chisq_solution(csq)`$

`r chisq_crit(csq)`

