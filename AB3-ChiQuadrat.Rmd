---
title: "Arbeitsblatt 3 - Chi-Quadrat-Tests"
author: "Statistik II - Andreas M. Brandmaier"
date: "`r format(Sys.time(), '%d. %B %Y')`"
output:
  pdf_document: 
    extra_dependencies: ["float","breqn","amsmath"]
  html_document: default
params:
  include_solution: true
---

```{r setup, include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.pos = "!H", out.extra = "") # prevent LaTeX tables from floating around

source("R/helper.R")
source("R/mcnemar.R")
source("R/chisq.R")

include_solution <- params$include_solution

empty_str <- "\\ "


```


# Aufgabe 1

```{r}
# generate data for exercise 1
set.seed(3249)
csq <- generate_chisq(labels.a=c("Neues Medikament","Altes Medikament"),
                           )
write.csv(file = "data/ab3-symptoms.csv", x=chisq_to_data(csq), row.names = FALSE)
```

In einer randomisierten Studie haben 40 Patienten ein neuartiges Antidepressivum erhalten und 40 Patienten ein bereits erprobtes. Nach vier Wochen wurde erhoben, ob sich eine Verbesserung der Symptomatik eingestellt hat. Dies wurde als dichotomes Merkmal _Verbesserung_ (ja/nein) erhoben. Ein Forscherteam hat die Hypothese, dass das neuartige Antidepressivum anders wirkt als die etablierte Behandlung (ungerichtete Hypothese).

Folgende Daten wurden beobachtet:

```{r, results="asis"}
chisq_data_table(csq)
```


Berechnen Sie zunächst die Spalten- und Randsummen für diese Häufigkeits-Tabelle. Erstellen Sie dann eine Tabelle von Häufigkeiten, die man erwarten würde, wenn es keinen Zusammenhang gäbe. Berechnen Sie dann die Prüfgröße für den $\chi^2$-Unabhängigkeits-Test und treffen Sie eine statistische Entscheidung. Wir gehen von einem Signifikanzniveau von 5% aus.


```{r, results="asis", eval=include_solution}
solution_header()

cat("Dies ist die Kontigenztabelle mit Zeilensummen und Spaltensummen:")

chisq_data_table(csq, type="sums")

cat("Dies ist die Tabelle der erwarteten Häufigkeiten unter der Unabhängigkeitsannahme:")

chisq_data_table(csq, type="indep")

wrap_math_block(chisq_solution(csq))

cat(chisq_crit(csq,undirected = TRUE))

cat("Der empirische _F_-Wert ist größer als der kritische Wert. Wir lehnen daher die Nullhypothese ab. Es gibt Unterschiede in der Wirksamkeit zwischen den Medikamenten.")

```

# Aufgabe 2
```{r}
csq <- generate_chisq(labels.a = c("Ja (vorher)"," Nein (vorher)"),
                      labels.b=c("Ja (Nachher)","Nein (Nachher)"), 
                                 short.labels.a=c("Ja","Nein"), 
                                 short.labels.b=c("Ja","Nein"),
                       tbl = matrix(c(45,13,25,43),ncol=2,byrow = FALSE))
write.csv("data/ab3-smoker.csv", x=chisq_to_data(csq),row.names = FALSE)
```
Ein Forscherteam untersucht die Wirksamkeit einer Anti-Raucher-Kampagne. Dazu wird das Rauchverhalten (ja/nein ) in derselben Stichprobe zweimal untersucht: einmal vor der Kampagne und einmal nach der Kampagne. Die Vermutung ist, dass die Rauchkampagne wirksam ist. Untersuchen Sie dies mit einer gerichteten Hypothese. Das Signifikanzniveau sei 5%.
Formulieren Sie die Null-Hypothese und rechnen Sie den richtigen Test. Treffen Sie eine statistisch informierte Entscheidung. Welche Effektstärke kann man hier berichten?



```{r, results="asis"}
chisq_data_table(csq)
```

```{r, results="asis", eval=include_solution}
cat("_Lösung:_\n\n")

cat("Eine gerichtete Hypothese bedeutet hier: Wir nehmen an, dass es mehr Wechsler von Raucher zu Nicht-Raucher (Populationswahrscheinlichkeit: $\\pi_{12}$) als Nicht-Raucher zu Raucher (Populationswahrscheinlichkeit: $\\pi_{21}$) gibt.\n $$H_0: \\pi_{12}>\\pi_{21}$$")

cat("Der Effekt geht in die 'richtige' Richtung, 25 > 13, also führen wir den einseitigen Test durch, um das Ergebnis abzusichern.")

wrap_math_block(mcnemar_solution(csq))
cat("\n")
cat(chisq_crit(csq, undirected=FALSE),"\n")
cat("Wir lehnen die Nullhypothese ab und glauben an die Wirksamkeit der Intervention zur Reduzierung der Anzahl der Raucher.")
 
cat("Als Effektstärke können wir das Verhältnis der Wechsler berechnen:\n")
wrap_math_block(mcnemar_effectsize(csq,1))

cat("oder als Prozentualen Anteil der Wechsler von Raucher zu Nichtraucher im Verhältnis zu allen Wechslern:\n")
wrap_math_block(mcnemar_effectsize(csq,2))
```

\pagebreak

# Aufgabe 3

Laut einer Statista-Studie (https://de.statista.com/statistik/daten/studie/30157/umfrage/anzahl-der-haustiere-in-deutschen-haushalten-seit-2008/) gehen wir davon aus, dass in der Bevölkerung die Vorliebe für Haustiere folgendermaßen verteilt ist:

- Katzen: 15.7%
- Hunde: 10.7%
- Andere: 13%
- Keine: 60.6%

Wir gehen weiterhin davon aus, dass keine Mehrfachnennungen möglich sind. In einer Studie wurde untersucht, ob sich die Vorlieben bei Psychologiestudierenden von der Normalbevölkerung unterscheiden. Beobachtet wurden folgende absoluten Häufigkeiten in einer Stichprobe von 120 Studierenden:


```{r}
obs <- c(29,16,15,60)
n <- sum(obs)
labels <- c("Katzen","Hunde","Andere","Keine")
expected <- c(15.7,10.7,13,60.6)/100
csq <- generate_chisq_uni( obs=obs,exp=expected,labels=labels )
write.csv(file = "data/ab3-cats_and_dogs.csv", chisq_to_data(csq), row.names = FALSE)
chisq_uni_data_table(csq) 
```

Prüfen Sie, ob sich die Vorlieben der Psychologiestudierenden von der Normalbevölkerung unterscheiden. Gehen Sie von einem Signifikanzniveau von 5% aus.

```{r, results="asis", eval=include_solution}
cat("_Lösung:_\n\n")

wrap_math_align(solution_chisq_uni(csq,1))
wrap_math_block(solution_chisq_uni(csq,2))
cat("\n")
cat(chisq_crit(csq))
cat("Wir lehnen die Nullhypothese ab und schließen daraus, dass sich die Vorlieben der Psychologiestudierenden von denen der Normalbevölkerung unterscheiden.")
```


# Aufgabe 4

In einer Studie wurde untersucht, ob sich das Interesse an einem A&O-Masterstudiengang über die Jahrgänge von Studierenden hinweg unterscheidet. Die Stichproben sind unabhängig, d.h. es wurden in einem Kalenderjahr Studierende aus verschiedenen Anfangssemestern befragt. Erhoben wurde, ob potentiell ein Interesse an dem Besuch des Masterstudiengangs besteht (codiert als ja/nein).  Folgende Kreuztabelle entstand aus den Daten der Jahrgänge:

```{r}
csq <- generate_chisq(labels.b = c("SS19","WS19/20","SS20","SS20/21"), labels.a=c("ja","nein"),tbl = matrix(c(88,12,95,5, 93,7,95,5), ncol=4))
```

```{r results="asis"}
chisq_data_table(csq) 
```

Prüfen Sie mit dem Unabhängigkeitstest, ob sich die Interessenlage über die Anfangssemester hinweg unterscheidet. Das Signifikanzniveau sei 5%.

```{r, results="asis", eval=include_solution}
cat("_Lösung:_\n\n")

chisq_data_table(csq, "indep")
cat("\n")
wrap_math_align(chisq_solution(csq))
#wrap_test(chisq_solution(csq))
cat("\n")
cat(chisq_crit(csq))
cat("Wir können die Nullhypothese nicht ablehnen.")
```

# Aufgabe 5
Wir bleiben bei den Daten aus Aufgabe 4. Wie müsste die Kontingenztabelle der beobachteten Häufigkeiten lauten, wenn man testen möchte, ob sich die Interessenlage in den Sommer- und Wintersemestern unterscheidet? Führen Sie den entsprechenden Unabhängigkeitstest durch.

```{r} 
# code to generate data of exercise 5
tbl <- cbind(rowSums(csq$tbl[,c(1,3)]),rowSums(csq$tbl[,c(2,4)]))
csq <- generate_chisq(labels.b = c("Sommer","Winter"), labels.a=c("ja","nein"),tbl=tbl)
```



```{r, results="asis", eval=include_solution}
#
# solution block - exercise 5
#
cat("_Lösung:_\n\n")

chisq_data_table(csq,  caption="Zusammengefasste Datentabelle")
cat("\n")
chisq_data_table(csq, type="indep", caption="Tabelle unter Unabhängigkeitsannahme")

wrap_math_block(chisq_solution(csq))
cat("\n")
cat(chisq_crit(csq))
cat("Wir können die Nullhypothese nicht ablehnen.")
```

