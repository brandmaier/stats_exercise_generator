---
title: "Arbeitsblatt 7 - Zweifaktorielle Varianzanalyse"
author: "Statistik II - Andreas M. Brandmaier"
date: "`r format(Sys.time(), '%d. %B %Y')`"
output:
  pdf_document: default
  html_document: default
params:
  include_solution: true
mainfont: SourceSansPro
header-includes:
   - \usepackage[default]{sourcesanspro}
   - \usepackage[T1]{fontenc}
---

```{r setup, include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.pos = "!H", out.extra = "") # prevent LaTeX tables from floating

source("R/anova-1f.R")
source("R/anova-2f.R")
source("R/helper.R")

include_solution <- params$include_solution

empty_str <- "\\ "


```



Im Folgenden finden Sie Übungsaufgaben zur zweifaktoriellen Varianzanalyse. Dabei sind im Allgemeinen die Quadratsummen, mittlere Quadratsummen und F-Werte zu berechnen. Ferner sind kritische Werte zu bestimmen, um eine statistische Entscheidung zu treffen. Runden Sie auf zwei Nachkommastellen (auch Zwischenergebnisse). Wenn die Aufgabenstellung nicht davon abweicht, gilt ein Signifikanzniveau von $5\%$.

# Aufgabe 1
```{r}
set.seed(985)
aov <- generate_anova_2f(av.name="Symptomschwere",
                  factor.a.levels = c("Psychotherapie","Psychopharmaka"),
                  factor.a.name = "Therapieform", factor.b.name = "Diagnose",
                  factor.b.levels = c("Depression","Angststörung","PTSD"),
                  obs_min = 0, obs_max = 20, nz = 5, obs_round = 2,
                  cellmeans_by_row = c(10, 8, 8,
                                   10, 7, 12))
```

In einer Studie wurde untersucht, inweit sich die Symptomschwere bei Personen mit verschiedenen Diagnosen verbessert abhängig davon, ob eine Psychotherapie durchgeführt wurde oder ob lediglich Psychopharmaka verschrieben wurden (Es handelt sich hier um fikitive Daten). Die beiden Faktoren Behandlung (2 Stufen) und Diagnose (3 Stufen) wurden zwischen Personen variiert, daher wurde eine zweifaktorielle Varianzanalyse (ohne Messwiederholung) für die Analyse der Beobachtungen eingesetzt. Gegeben sind folgende Quadratsummen:

```{r}
cat("$QS_A=",aov$qs_A,"$, $QS_B=$",aov$qs_b,"$, $QS_{AxB}=",aov$qs_AxB,"$,QS_{inn}=$",aov$qs_inn,"$\n")
```


```{r message=FALSE, warning=FALSE}

show_table_of_means(aov)

data_plot(aov)
```

# Aufgabe 1

Führen Sie eine zweifaktorielle Varianzanalyse vollständig durch (beachten Sie, dass die Quadratsummen schon gegeben sind). Formulieren Sie die Nullypothesen (in Worten) und testen Sie die Haupteffekte und Interaktion auf Signifikanz. Formulieren Sie Antwortsätze für Ihre statistische Entscheidung.


```{r results="asis", message=FALSE, warning=FALSE}
cat("Wir testen drei Hypothesenpaare: $H0_a$: Es gibt keinen Haupteffekt von  Therapieform\nH0_b: Es gibt keinen Haupteffekt von Diagnose.\n$H0_c: Es gibt keine Wechselwirkung von Therapieform und Diagnose.\n\n")

wrap_math_block(solution_df(aov))
cat("\n")
wrap_math_block(solution_mqs(aov))
cat("\n")
wrap_math_block(solution_f(aov))
cat("\n")

cat("Der kritische Wert für den Test des Haupteffekts des Faktors A lautet:\n")
wrap_math_block(f_crit(aov,type="A"))
cat("Der kritische Wert für den Test des Haupteffekts des Faktors B lautet:\n")
wrap_math_block(f_crit(aov,type="B"))
cat("Der kritische Wert für den Test der Wechselwirkung:\n")
wrap_math_block(f_crit(aov,type="AxB"))

cat("Es entsteht folgende Ergebnistabelle (hier auch mit p-Werten, die Sie anhand der Tabellen nicht ausrechnen können. Das überlassen wir dem Computer):\n")

result_table(aov)

#knitr::kable(anova_in_R(aov))
```
# Aufgabe 2

Wir bleiben bei dem Beispiel aus Aufgabe 1
```{r}


interaction_plot(aov, empty=TRUE)
```

## Aufgabe 1a

Im folgenden sehen Sie das Interaktionsdiagramm, das aus den eben vorgestellten Daten erzeugt wurde. Wie nennt man die Interaktionsart und was bedeutet Sie für die globale Interpretierbarkeit der Haupteffekte?

```{r}
interaction_plot(aov)
```

## Aufgabe 2a

Welcher der folgenden Tortendiagramme passt zu der durchgeführten Varianzanalyse?

```{r}
aov_fake <- aov
aov_fake$qs_A <- aov$qs_AxB
aov_fake$qs_AxB <- aov$qs_A

aov_fake2 <- aov
aov_fake2$qs_B <- aov$qs_B*3
aov_fake2$qs_inn <- aov$qs_inn*3

aov_fake3 <- aov
aov_fake3$qs_A <- 4*aov$qs_A

p1<-pie_plot(aov)+ggtitle("Torte A")
p2<-pie_plot(aov_fake)+ggtitle("Torte B")
p3<-pie_plot(aov_fake2)+ggtitle("Torte C")
p4<-pie_plot(aov_fake3)+ggtitle("Torte C")

library(patchwork)
(p1 + p2)  / (p3 + p4)
```
## Aufgabe 2

Im Rahmen einer Untersuchung zu der Wirksamkeit verschiedener Präsentationsformen von Lehrinhalten wird untersucht, ob Studierende Inhalte besser durch eine Vorlesung oder durch das Schauen von Youtube-Videos erlernen (Faktor A: Lehrform). Dabei werden weiterhin zwei verschiedene Lerninhalte unterschieden (Faktor B): Statistik oder Schminktipps. Am Ende wird im Rahmen eines standardisierten Verfahrens der Lernerfolg (abhängige Variable) erfasst, der hier als intervallskalierte Variable angenommen werden kann. 
Führen Sie eine zweifaktorielle Varianzanalyse durch, um die Frage zu beantworten, ob es Haupteffekte der Lehrform, der Lerninhalte und eine Wechselwirkung der beiden gibt.

```{r}
set.seed(985)
aov <- generate_anova_2f(av.name="Lernerfolg",
                  factor.a.levels = c("Vorlesung","Youtube-Video"),
                  factor.a.name = "Lehrform", factor.b.name = "Lerninhalt",
                  factor.b.levels = c("Statistik","Schminktipps"),
                  obs_min = 0, obs_max = 100, nz = 15, cellmeans_by_row = c(70, 50,
                                                                          15, 80))

show_table_of_means(aov)

result_table(aov)
```

```{r}
interaction_plot(aov)


``` 